import{a as g,r as w,h as L,o as r,c as h,b as l,d as n,b7 as U,U as D,w as i,ae as M,b8 as m,a8 as V,J as N,aa as q,ac as f,ab as b,V as _,e as O,f as u}from"./index.32f3a1c0.js";import{m as P,a as j,_ as z,F as G}from"./zh-tw.34737b37.js";import{V as I}from"./VTable.f4f2b9c0.js";import{V as $}from"./VDialog.b8a02727.js";import{V as J,a as H}from"./VTextField.1c81cea9.js";import{V as B,b as K,a as T,c as Q}from"./VCard.7ecc493d.js";import{V as R}from"./VSpacer.b8c0c6ab.js";const W={class:"container mt-5"},X={id:"calendars"},Y=l("div",{class:"col-12"},[l("h1",{class:"text-center"},"\u884C\u4E8B\u66C6\u7BA1\u7406")],-1),Z={class:"row mt-5"},ee={class:"col-12"},te=l("thead",null,[l("tr",null,[l("th",null,"\u6A19\u984C"),l("th",null,"\u958B\u59CB\u65E5\u671F"),l("th",null,"\u7D50\u675F\u65E5\u671F"),l("th",{colspan:"2"},"\u7BA1\u7406")])],-1),ae=u("\u7DE8\u8F2F"),le=u("\u7DE8\u8F2F"),se=u("\u522A\u9664"),ne=u("\u522A\u9664"),ie={key:1},oe=l("td",{class:"text-center",colspan:"5"},[l("h3",{class:"mt-3"},"\u6C92\u6709\u884C\u4E8B\u66C6 ")],-1),de=[oe],re={class:"text-h5"},ue={class:"container"},ce={class:"row"},_e={class:"col-12"},me=u("\u53D6\u6D88"),fe=u("\u78BA\u5B9A"),xe={__name:"CalendarsView",setup(pe){const o=g([]),c=10,d=w(1),C=L(()=>o.slice(d.value*c-c,d.value*c)),y=w(!1),x=w(""),p=g({plugins:[P,j],select:async s=>{let e=prompt("\u8ACB\u8F38\u5165\u6A19\u984C");if(e!==""){if(e===null)return;{const{data:a}=await m.post("/calendars",{startDate:s.startStr,endDate:s.endStr,title:e});p.events.push({id:a.calendar._id,title:a.calendar.title,start:new Date(a.calendar.startDate),end:new Date(a.calendar.endDate),allDay:!0})}}},eventClick:({event:s})=>{y.value=!0,x.value=s._def.title},initialView:"dayGridMonth",locale:z,selectable:!0,selectOverlap:!0,events:[]}),t=g({_id:"",title:"",date:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),A=g({required(s){return!!s||"\u5FC5\u586B"}}),S=async(s,e)=>{await m.delete("/calendars/"+s),o.splice(e,1),p.events.splice(e,1)},F=(s,e)=>{t._id=s,e>-1?(t.title=o[e].title,t.date=o[e].date):(t.title="",t.date=""),t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},E=async()=>{if(!t.valid)return;t.submitting=!0;const s=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||s.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await m.post("/calendars",s);o.push(e.calendar),V.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await m.patch("/calendars/"+t._id,s);o[t.idx]=e.calendar,V.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){V.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1};return(async()=>{try{const{data:s}=await m.get("/calendars/all");o.push(...s.calendar),p.events.push(...s.calendar.map(e=>({id:e._id,title:e.title,start:new Date(e.startDate),end:new Date(e.endDate),allDay:!0})))}catch(s){V.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}})(),(s,e)=>(r(),h("div",W,[l("div",X,[Y,n(U),n(D(G),{options:p},null,8,["options"])]),l("div",Z,[n(U),l("div",ee,[n(I,null,{default:i(()=>[te,l("tbody",null,[D(C).length>0?(r(!0),h(N,{key:0},q(D(C),(a,v)=>(r(),h("tr",{key:a._id},[l("td",null,f(a.title),1),l("td",null,f(new Date(a.startDate).toLocaleDateString()),1),l("td",null,f(new Date(a.endDate).toLocaleDateString()),1),l("td",null,[d.value===1?(r(),b(_,{key:0,color:"blue darken-4",onClick:k=>F(a._id,v),variant:"outlined"},{default:i(()=>[ae]),_:2},1032,["onClick"])):(r(),b(_,{key:1,color:"blue darken-4",onClick:k=>F(a._id,v+(d.value-1)*c),variant:"outlined"},{default:i(()=>[le]),_:2},1032,["onClick"]))]),l("td",null,[d.value===1?(r(),b(_,{key:0,color:"error",onClick:k=>S(a._id,v),variant:"outlined"},{default:i(()=>[se]),_:2},1032,["onClick"])):(r(),b(_,{key:1,color:"error",onClick:k=>S(a._id,v+(d.value-1)*c),variant:"outlined"},{default:i(()=>[ne]),_:2},1032,["onClick"]))])]))),128)):(r(),h("tr",ie,de))])]),_:1})])]),n($,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=a=>t.dialog=a),scrollable:""},{default:i(()=>[n(J,{modelValue:t.valid,"onUpdate:modelValue":e[2]||(e[2]=a=>t.valid=a),onSubmit:O(E,["prevent"]),style:{height:"900px",width:"500px"}},{default:i(()=>[n(B,null,{default:i(()=>[n(K,null,{default:i(()=>[l("div",re,f(t._id.length>0?"\u7DE8\u8F2F\u884C\u4E8B\u66C6":"\u65B0\u589E\u884C\u4E8B\u66C6"),1)]),_:1}),n(T,null,{default:i(()=>[l("div",ue,[l("div",ce,[l("div",_e,[n(H,{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=a=>t.title=a),label:"\u6A19\u984C",rules:[A.required],variant:"outlined"},null,8,["modelValue","rules"])])])])]),_:1}),n(Q,null,{default:i(()=>[n(R),n(_,{color:"error",onClick:e[1]||(e[1]=a=>t.dialog=!1),disabled:t.submitting},{default:i(()=>[me]),_:1},8,["disabled"]),n(_,{type:"submit",color:"blue darken-4",loading:t.submitting},{default:i(()=>[fe]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"]),n($,{class:"display-flex justify-content-center",modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=a=>y.value=a)},{default:i(()=>[n(B,null,{default:i(()=>[n(T,null,{default:i(()=>[u(f(x.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(M,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),length:Math.ceil(o.length/c),rounded:"circle","next-icon":"mdi-menu-right","prev-icon":"mdi-menu-left"},null,8,["modelValue","length"])]))}};export{xe as default};
