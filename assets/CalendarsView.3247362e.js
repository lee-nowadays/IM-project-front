import{a as m,r as D,o as f,c as _,b as i,d as a,w as n,a7 as w,U as B,b8 as r,a9 as p,N,ab as $,ad as d,V,e as E,f as u}from"./index.62a58031.js";import{m as L,a as q,_ as M,F as O}from"./zh-tw.a880d155.js";import{a as h,V as y}from"./VRow.268838cb.js";import{V as x}from"./VDialog.7d31a20a.js";import{V as j}from"./VTable.2b543c2e.js";import{V as G,a as I}from"./VTextField.63a6398b.js";import{V as C,b as R,a as k,c as z}from"./VCard.81114303.js";import{V as H}from"./VContainer.9798928d.js";import{V as J}from"./VSpacer.c4ca8cfd.js";const K={class:"container mt-5"},P={id:"calendars"},Q=i("h1",{class:"text-center"},"\u884C\u4E8B\u66C6\u7BA1\u7406",-1),W=i("thead",null,[i("tr",null,[i("th",null,"\u6A19\u984C"),i("th",null,"\u958B\u59CB\u65E5\u671F"),i("th",null,"\u7D50\u675F\u65E5\u671F"),i("th",{colspan:"2"},"\u7BA1\u7406")])],-1),X=u("\u7DE8\u8F2F"),Y=u("\u522A\u9664"),Z={key:1},ee=i("td",{class:"text-center",colspan:"5"},[i("h3",{class:"mt-3"},"\u6C92\u6709\u884C\u4E8B\u66C6 ")],-1),te=[ee],ae={class:"text-h5"},le=u("\u53D6\u6D88"),se=u("\u78BA\u5B9A"),he={__name:"CalendarsView",setup(ne){const o=m([]),g=D(!1),v=D(""),c=m({plugins:[L,q],select:async l=>{let e=prompt("\u8ACB\u8F38\u5165\u6A19\u984C");if(e!==""){if(e===null)return;{const{data:s}=await r.post("/calendars",{startDate:l.startStr,endDate:l.endStr,title:e});c.events.push({id:s.calendar._id,title:s.calendar.title,start:new Date(s.calendar.startDate),end:new Date(s.calendar.endDate),allDay:!0})}}},eventClick:({event:l})=>{g.value=!0,v.value=l._def.title},initialView:"dayGridMonth",locale:M,selectable:!0,selectOverlap:!0,events:[]}),t=m({_id:"",title:"",date:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),S=m({required(l){return!!l||"\u5FC5\u586B"}}),F=async(l,e)=>{await r.delete("/calendars/"+l),o.splice(e,1),c.events.splice(e,1)},T=(l,e)=>{t._id=l,e>-1?(t.title=o[e].title,t.date=o[e].date):(t.title="",t.date=""),t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},U=async()=>{if(!t.valid)return;t.submitting=!0;const l=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||l.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await r.post("/calendars",l);o.push(e.calendar),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await r.patch("/calendars/"+t._id,l);o[t.idx]=e.calendar,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){p.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1};return(async()=>{try{const{data:l}=await r.get("/calendars/all");o.push(...l.calendar),c.events.push(...l.calendar.map(e=>({id:e._id,title:e.title,start:new Date(e.startDate),end:new Date(e.endDate),allDay:!0})))}catch(l){p.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}})(),(l,e)=>(f(),_("div",K,[i("div",P,[a(h,{cols:"12"},{default:n(()=>[Q]),_:1}),a(w),a(B(O),{options:c},null,8,["options"])]),a(y,{class:"mt-5"},{default:n(()=>[a(w),a(h,{cols:"12"},{default:n(()=>[a(j,null,{default:n(()=>[W,i("tbody",null,[o.length>0?(f(!0),_(N,{key:0},$(o,(s,b)=>(f(),_("tr",{key:s._id},[i("td",null,d(s.title),1),i("td",null,d(new Date(s.startDate).toLocaleDateString()),1),i("td",null,d(new Date(s.endDate).toLocaleDateString()),1),i("td",null,[a(V,{color:"blue darken-4",onClick:A=>T(s._id,b),variant:"outlined"},{default:n(()=>[X]),_:2},1032,["onClick"])]),i("td",null,[a(V,{color:"error",onClick:A=>F(s._id,b),variant:"outlined"},{default:n(()=>[Y]),_:2},1032,["onClick"])])]))),128)):(f(),_("tr",Z,te))])]),_:1})]),_:1})]),_:1}),a(x,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=s=>t.dialog=s),scrollable:""},{default:n(()=>[a(G,{modelValue:t.valid,"onUpdate:modelValue":e[2]||(e[2]=s=>t.valid=s),onSubmit:E(U,["prevent"]),style:{height:"900px",width:"500px"}},{default:n(()=>[a(C,null,{default:n(()=>[a(R,null,{default:n(()=>[i("div",ae,d(t._id.length>0?"\u7DE8\u8F2F\u884C\u4E8B\u66C6":"\u65B0\u589E\u884C\u4E8B\u66C6"),1)]),_:1}),a(k,null,{default:n(()=>[a(H,null,{default:n(()=>[a(y,null,{default:n(()=>[a(h,{cols:"12"},{default:n(()=>[a(I,{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=s=>t.title=s),label:"\u6A19\u984C",rules:[S.required],variant:"outlined"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:n(()=>[a(J),a(V,{color:"error",onClick:e[1]||(e[1]=s=>t.dialog=!1),disabled:t.submitting},{default:n(()=>[le]),_:1},8,["disabled"]),a(V,{type:"submit",color:"primary",loading:t.submitting},{default:n(()=>[se]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"]),a(x,{class:"display-flex justify-content-center",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=s=>g.value=s)},{default:n(()=>[a(C,null,{default:n(()=>[a(k,null,{default:n(()=>[u(d(v.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{he as default};
