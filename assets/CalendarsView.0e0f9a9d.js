import{a as _,r as b,h as M,o as p,c as V,b as i,d as a,w as n,b7 as k,U as w,ae as N,b8 as r,a8 as g,J as q,aa as O,ac as d,V as v,e as P,f as u}from"./index.a1351669.js";import{m as j,a as z,_ as G,F as I}from"./zh-tw.dbebf34c.js";import{a as D,V as S}from"./VRow.bfc144f0.js";import{V as F}from"./VDialog.ffa0cb7c.js";import{V as J}from"./VTable.406e9dbf.js";import{V as R,a as H}from"./VTextField.96136ffc.js";import{V as U,b as K,a as T,c as Q}from"./VCard.29189499.js";import{V as W}from"./VContainer.a35e5c4c.js";import{V as X}from"./VSpacer.3edbb3f5.js";/* empty css              */const Y={class:"container mt-5"},Z={id:"calendars"},ee=i("h1",{class:"text-center"},"\u884C\u4E8B\u66C6\u7BA1\u7406",-1),te=i("thead",null,[i("tr",null,[i("th",null,"\u6A19\u984C"),i("th",null,"\u958B\u59CB\u65E5\u671F"),i("th",null,"\u7D50\u675F\u65E5\u671F"),i("th",{colspan:"2"},"\u7BA1\u7406")])],-1),ae=u("\u7DE8\u8F2F"),le=u("\u522A\u9664"),se={key:1},ne=i("td",{class:"text-center",colspan:"5"},[i("h3",{class:"mt-3"},"\u6C92\u6709\u884C\u4E8B\u66C6 ")],-1),ie=[ne],oe={class:"text-h5"},re=u("\u53D6\u6D88"),de=u("\u78BA\u5B9A"),xe={__name:"CalendarsView",setup(ue){const o=_([]),c=10,m=b(1),y=M(()=>o.slice(m.value*c-c,m.value*c));console.log(o);const h=b(!1),x=b(""),f=_({plugins:[j,z],select:async l=>{let e=prompt("\u8ACB\u8F38\u5165\u6A19\u984C");if(e!==""){if(e===null)return;{const{data:s}=await r.post("/calendars",{startDate:l.startStr,endDate:l.endStr,title:e});f.events.push({id:s.calendar._id,title:s.calendar.title,start:new Date(s.calendar.startDate),end:new Date(s.calendar.endDate),allDay:!0})}}},eventClick:({event:l})=>{h.value=!0,x.value=l._def.title},initialView:"dayGridMonth",locale:G,selectable:!0,selectOverlap:!0,events:[]}),t=_({_id:"",title:"",date:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),A=_({required(l){return!!l||"\u5FC5\u586B"}}),B=async(l,e)=>{await r.delete("/calendars/"+l),o.splice(e,1),f.events.splice(e,1)},$=(l,e)=>{t._id=l,e>-1?(t.title=o[e].title,t.date=o[e].date):(t.title="",t.date=""),t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},E=async()=>{if(!t.valid)return;t.submitting=!0;const l=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||l.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await r.post("/calendars",l);o.push(e.calendar),g.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await r.patch("/calendars/"+t._id,l);o[t.idx]=e.calendar,g.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){g.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1};return(async()=>{try{const{data:l}=await r.get("/calendars/all");o.push(...l.calendar),f.events.push(...l.calendar.map(e=>({id:e._id,title:e.title,start:new Date(e.startDate),end:new Date(e.endDate),allDay:!0})))}catch(l){g.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}})(),(l,e)=>(p(),V("div",Y,[i("div",Z,[a(D,{cols:"12"},{default:n(()=>[ee]),_:1}),a(k),a(w(I),{options:f},null,8,["options"])]),a(S,{class:"mt-5"},{default:n(()=>[a(k),a(D,{cols:"12"},{default:n(()=>[a(J,null,{default:n(()=>[te,i("tbody",null,[w(y).length>0?(p(!0),V(q,{key:0},O(w(y),(s,C)=>(p(),V("tr",{key:s._id},[i("td",null,d(s.title),1),i("td",null,d(new Date(s.startDate).toLocaleDateString()),1),i("td",null,d(new Date(s.endDate).toLocaleDateString()),1),i("td",null,[a(v,{color:"blue darken-4",onClick:L=>$(s._id,C),variant:"outlined"},{default:n(()=>[ae]),_:2},1032,["onClick"])]),i("td",null,[a(v,{color:"error",onClick:L=>B(s._id,C),variant:"outlined"},{default:n(()=>[le]),_:2},1032,["onClick"])])]))),128)):(p(),V("tr",se,ie))])]),_:1})]),_:1})]),_:1}),a(F,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=s=>t.dialog=s),scrollable:""},{default:n(()=>[a(R,{modelValue:t.valid,"onUpdate:modelValue":e[2]||(e[2]=s=>t.valid=s),onSubmit:P(E,["prevent"]),style:{height:"900px",width:"500px"}},{default:n(()=>[a(U,null,{default:n(()=>[a(K,null,{default:n(()=>[i("div",oe,d(t._id.length>0?"\u7DE8\u8F2F\u884C\u4E8B\u66C6":"\u65B0\u589E\u884C\u4E8B\u66C6"),1)]),_:1}),a(T,null,{default:n(()=>[a(W,null,{default:n(()=>[a(S,null,{default:n(()=>[a(D,{cols:"12"},{default:n(()=>[a(H,{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=s=>t.title=s),label:"\u6A19\u984C",rules:[A.required],variant:"outlined"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,null,{default:n(()=>[a(X),a(v,{color:"error",onClick:e[1]||(e[1]=s=>t.dialog=!1),disabled:t.submitting},{default:n(()=>[re]),_:1},8,["disabled"]),a(v,{type:"submit",color:"primary",loading:t.submitting},{default:n(()=>[de]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"]),a(F,{class:"display-flex justify-content-center",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s)},{default:n(()=>[a(U,null,{default:n(()=>[a(T,null,{default:n(()=>[u(d(x.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=s=>m.value=s),length:Math.ceil(o.length/c),rounded:"circle","next-icon":"mdi-menu-right","prev-icon":"mdi-menu-left"},null,8,["modelValue","length"])]))}};export{xe as default};
