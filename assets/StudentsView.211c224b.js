import{a as A,r as U,h as q,o as u,c as f,b as s,d as o,b7 as S,w as n,V as m,ae as $,b8 as h,a8 as g,U as I,J as B,aa as D,ac as V,ab as b,e as F,f as _}from"./index.8f1e378f.js";import{V as T}from"./VTable.594078bd.js";import{V as E}from"./VDialog.e0c8d061.js";import{V as N,a as c}from"./VTextField.b1aec233.js";import{V as M,b as P,a as z,c as J}from"./VCard.19aa4e62.js";import{V as L}from"./VSpacer.ae8836ee.js";const j={class:"container mt-5"},G={id:"students"},H={class:"row"},K=s("div",{class:"col-12"},[s("h1",{class:"text-center"},"\u5B78\u751F\u7BA1\u7406")],-1),O={class:"col-12"},Q=_("\u65B0\u589E\u5B78\u751F"),R={class:"col-12"},W=s("thead",null,[s("tr",null,[s("th",null,"\u5B78\u865F"),s("th",null,"\u73ED\u7D1A"),s("th",null,"\u59D3\u540D"),s("th",null,"\u96FB\u8A71"),s("th",{colspan:"2"},"\u7BA1\u7406")])],-1),X=_("\u7DE8\u8F2F"),Y=_("\u7DE8\u8F2F"),Z=_("\u522A\u9664"),ee=_("\u522A\u9664"),le={key:1},te=s("td",{class:"text-center",colspan:"5"},"\u6C92\u6709\u5B78\u751F ",-1),se=[te],oe={class:"text-h5"},ae={class:"container"},de={class:"row"},ne={class:"col-12"},ie={class:"col-12"},re={class:"col-12"},ue={class:"col-12 col-md-6"},ce={class:"col-12 col-md-6"},me={class:"col-12 col-md-6"},_e={class:"col-12 col-md-6"},pe={class:"col-12"},Ve=_("\u53D6\u6D88"),ve=_("\u78BA\u5B9A"),we={__name:"StudentsView",setup(fe){const d=A([]),p=10,i=U(1),C=q(()=>d.slice(i.value*p-p,i.value*p)),e=A({_id:"",studentId:"",name:"",class:"",phone:"",residenceAddress:"",currentAddress:"",personalId:"",email:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),r=A({studentId(a){/^[0-9]+$/.test(a),a.length>=8&&a.length<=8},required(a){return!!a||"\u5FC5\u586B"}}),k=(a,l)=>{e._id=a,l>-1?(e.studentId=d[l].studentId,e.name=d[l].name,e.class=d[l].class,e.phone=d[l].phone,e.residenceAddress=d[l].residenceAddress,e.currentAddress=d[l].currentAddress,e.personalId=d[l].personalId,e.email=d[l].email):(e.studentId="",e.name="",e.class="",e.phone="",e.residenceAddress="",e.currentAddress="",e.personalId="",e.email=""),e.idx=l,e.dialog=!0,e.valid=!1,e.submitting=!1},w=async(a,l)=>{await h.delete("/students/"+a),d.splice(l,1)},x=async()=>{if(!e.valid)return;e.submitting=!0;const a=new FormData;for(const l in e)["_id","idx","dialog","valid","submitting"].includes(l)||a.append(l,e[l]);try{if(e._id.length===0){const{data:l}=await h.post("/students",a);d.push(l.student),g.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:l}=await h.patch("/students/"+e._id,a);d[e.idx]=l.student,g.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(l){g.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}e.submitting=!1};return(async()=>{try{const{data:a}=await h.get("/students/all");d.push(...a.student)}catch(a){g.fire({icon:"error",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}})(),(a,l)=>(u(),f("div",j,[s("div",G,[s("div",H,[K,o(S),s("div",O,[o(m,{class:"text-white",color:"blue darken-4",onClick:l[0]||(l[0]=t=>k("",-1))},{default:n(()=>[Q]),_:1})]),s("div",R,[o(T,null,{default:n(()=>[W,s("tbody",null,[I(C).length>0?(u(!0),f(B,{key:0},D(I(C),(t,v)=>(u(),f("tr",{key:t._id},[s("td",null,V(t.studentId),1),s("td",null,V(t.class),1),s("td",null,V(t.name),1),s("td",null,V(t.phone),1),s("td",null,[i.value===1?(u(),b(m,{key:0,color:"blue darken-4",onClick:y=>k(t._id,v),variant:"outlined"},{default:n(()=>[X]),_:2},1032,["onClick"])):(u(),b(m,{key:1,color:"blue darken-4",onClick:y=>k(t._id,v+(i.value-1)*p),variant:"outlined"},{default:n(()=>[Y]),_:2},1032,["onClick"]))]),s("td",null,[i.value===1?(u(),b(m,{key:0,color:"error",onClick:y=>w(t._id,v),variant:"outlined"},{default:n(()=>[Z]),_:2},1032,["onClick"])):(u(),b(m,{key:1,color:"error",onClick:y=>w(t._id,v+(i.value-1)*p),variant:"outlined"},{default:n(()=>[ee]),_:2},1032,["onClick"]))])]))),128)):(u(),f("tr",le,se))])]),_:1})])]),o(E,{modelValue:e.dialog,"onUpdate:modelValue":l[11]||(l[11]=t=>e.dialog=t),scrollable:""},{default:n(()=>[o(N,{modelValue:e.valid,"onUpdate:modelValue":l[10]||(l[10]=t=>e.valid=t),onSubmit:F(x,["prevent"]),style:{height:"900px",width:"100%"}},{default:n(()=>[o(M,null,{default:n(()=>[o(P,null,{default:n(()=>[s("div",oe,V(e._id.length>0?"\u7DE8\u8F2F\u5B78\u751F":"\u65B0\u589E\u5B78\u751F"),1)]),_:1}),o(z,null,{default:n(()=>[s("div",ae,[s("div",de,[s("div",ne,[o(c,{modelValue:e.studentId,"onUpdate:modelValue":l[1]||(l[1]=t=>e.studentId=t),label:"\u5B78\u865F",rules:[r.required],variant:"outlined",counter:"8",maxlength:"8"},null,8,["modelValue","rules"])]),s("div",ie,[o(c,{modelValue:e.personalId,"onUpdate:modelValue":l[2]||(l[2]=t=>e.personalId=t),label:"\u8EAB\u4EFD\u8B49\u5B57\u865F",rules:[r.required],variant:"outlined",counter:"10",maxlength:"10"},null,8,["modelValue","rules"])]),s("div",re,[o(c,{modelValue:e.name,"onUpdate:modelValue":l[3]||(l[3]=t=>e.name=t),label:"\u59D3\u540D",rules:[r.required],variant:"outlined"},null,8,["modelValue","rules"])]),s("div",ue,[o(c,{modelValue:e.class,"onUpdate:modelValue":l[4]||(l[4]=t=>e.class=t),label:"\u73ED\u7D1A",rules:[r.required],variant:"outlined"},null,8,["modelValue","rules"])]),s("div",ce,[o(c,{modelValue:e.phone,"onUpdate:modelValue":l[5]||(l[5]=t=>e.phone=t),label:"\u624B\u6A5F",rules:[r.required],variant:"outlined",counter:"10",maxlength:"10"},null,8,["modelValue","rules"])]),s("div",me,[o(c,{modelValue:e.residenceAddress,"onUpdate:modelValue":l[6]||(l[6]=t=>e.residenceAddress=t),label:"\u6236\u7C4D\u5730\u5740",rules:[r.required],variant:"outlined"},null,8,["modelValue","rules"])]),s("div",_e,[o(c,{modelValue:e.currentAddress,"onUpdate:modelValue":l[7]||(l[7]=t=>e.currentAddress=t),label:"\u806F\u7D61\u5730\u5740",rules:[r.required],variant:"outlined"},null,8,["modelValue","rules"])]),s("div",pe,[o(c,{modelValue:e.email,"onUpdate:modelValue":l[8]||(l[8]=t=>e.email=t),label:"\u4FE1\u7BB1",rules:[r.required],variant:"outlined"},null,8,["modelValue","rules"])])])])]),_:1}),o(J,null,{default:n(()=>[o(L),o(m,{color:"error",onClick:l[9]||(l[9]=t=>e.dialog=!1),disabled:e.submitting},{default:n(()=>[Ve]),_:1},8,["disabled"]),o(m,{type:"submit",color:"blue darken-4",loading:e.submitting},{default:n(()=>[ve]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"]),o($,{modelValue:i.value,"onUpdate:modelValue":l[12]||(l[12]=t=>i.value=t),length:Math.ceil(d.length/p),rounded:"circle","next-icon":"mdi-menu-right","prev-icon":"mdi-menu-left"},null,8,["modelValue","length"])])]))}};export{we as default};
