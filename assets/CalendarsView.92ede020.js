import{a as V,r as w,h as N,o as d,c as g,b as o,d as a,w as n,b7 as $,U as D,ae as q,b8 as _,a8 as h,J as O,aa as P,ac as f,ab as y,V as m,e as j,f as u}from"./index.c09feab8.js";import{m as z,a as G,_ as I,F as J}from"./zh-tw.40342533.js";import{a as C,V as B}from"./VRow.b2dd5118.js";import{V as T}from"./VDialog.c2c20749.js";import{V as R}from"./VTable.a7c5461f.js";import{V as H,a as K}from"./VTextField.23a437de.js";import{V as A,b as Q,a as E,c as W}from"./VCard.c71b3490.js";import{V as X}from"./VContainer.08ce029d.js";import{V as Y}from"./VSpacer.15f6d922.js";/* empty css              */const Z={class:"container mt-5"},ee={id:"calendars"},te=o("h1",{class:"text-center"},"\u884C\u4E8B\u66C6\u7BA1\u7406",-1),le=o("thead",null,[o("tr",null,[o("th",null,"\u6A19\u984C"),o("th",null,"\u958B\u59CB\u65E5\u671F"),o("th",null,"\u7D50\u675F\u65E5\u671F"),o("th",{colspan:"2"},"\u7BA1\u7406")])],-1),ae=u("\u7DE8\u8F2F"),se=u("\u7DE8\u8F2F"),ne=u("\u522A\u9664"),oe=u("\u522A\u9664"),ie={key:1},re=o("td",{class:"text-center",colspan:"5"},[o("h3",{class:"mt-3"},"\u6C92\u6709\u884C\u4E8B\u66C6 ")],-1),de=[re],ue={class:"text-h5"},ce=u("\u53D6\u6D88"),me=u("\u78BA\u5B9A"),Se={__name:"CalendarsView",setup(_e){const i=V([]),c=10,r=w(1),x=N(()=>i.slice(r.value*c-c,r.value*c));console.log(i);const b=w(!1),S=w(""),p=V({plugins:[z,G],select:async s=>{let e=prompt("\u8ACB\u8F38\u5165\u6A19\u984C");if(e!==""){if(e===null)return;{const{data:l}=await _.post("/calendars",{startDate:s.startStr,endDate:s.endStr,title:e});p.events.push({id:l.calendar._id,title:l.calendar.title,start:new Date(l.calendar.startDate),end:new Date(l.calendar.endDate),allDay:!0})}}},eventClick:({event:s})=>{b.value=!0,S.value=s._def.title},initialView:"dayGridMonth",locale:I,selectable:!0,selectOverlap:!0,events:[]}),t=V({_id:"",title:"",date:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),L=V({required(s){return!!s||"\u5FC5\u586B"}}),F=async(s,e)=>{await _.delete("/calendars/"+s),i.splice(e,1),p.events.splice(e,1)},U=(s,e)=>{t._id=s,e>-1?(t.title=i[e].title,t.date=i[e].date):(t.title="",t.date=""),t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},M=async()=>{if(!t.valid)return;t.submitting=!0;const s=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||s.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await _.post("/calendars",s);i.push(e.calendar),h.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await _.patch("/calendars/"+t._id,s);i[t.idx]=e.calendar,h.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){h.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1};return(async()=>{try{const{data:s}=await _.get("/calendars/all");i.push(...s.calendar),p.events.push(...s.calendar.map(e=>({id:e._id,title:e.title,start:new Date(e.startDate),end:new Date(e.endDate),allDay:!0})))}catch(s){h.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}})(),(s,e)=>(d(),g("div",Z,[o("div",ee,[a(C,{cols:"12"},{default:n(()=>[te]),_:1}),a($),a(D(J),{options:p},null,8,["options"])]),a(B,{class:"mt-5"},{default:n(()=>[a($),a(C,{cols:"12"},{default:n(()=>[a(R,null,{default:n(()=>[le,o("tbody",null,[D(x).length>0?(d(!0),g(O,{key:0},P(D(x),(l,v)=>(d(),g("tr",{key:l._id},[o("td",null,f(l.title),1),o("td",null,f(new Date(l.startDate).toLocaleDateString()),1),o("td",null,f(new Date(l.endDate).toLocaleDateString()),1),o("td",null,[r.value===1?(d(),y(m,{key:0,color:"blue darken-4",onClick:k=>U(l._id,v),variant:"outlined"},{default:n(()=>[ae]),_:2},1032,["onClick"])):(d(),y(m,{key:1,color:"blue darken-4",onClick:k=>U(l._id,v+(r.value-1)*c),variant:"outlined"},{default:n(()=>[se]),_:2},1032,["onClick"]))]),o("td",null,[r.value===1?(d(),y(m,{key:0,color:"error",onClick:k=>F(l._id,v),variant:"outlined"},{default:n(()=>[ne]),_:2},1032,["onClick"])):(d(),y(m,{key:1,color:"error",onClick:k=>F(l._id,v+(r.value-1)*c),variant:"outlined"},{default:n(()=>[oe]),_:2},1032,["onClick"]))])]))),128)):(d(),g("tr",ie,de))])]),_:1})]),_:1})]),_:1}),a(T,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=l=>t.dialog=l),scrollable:""},{default:n(()=>[a(H,{modelValue:t.valid,"onUpdate:modelValue":e[2]||(e[2]=l=>t.valid=l),onSubmit:j(M,["prevent"]),style:{height:"900px",width:"500px"}},{default:n(()=>[a(A,null,{default:n(()=>[a(Q,null,{default:n(()=>[o("div",ue,f(t._id.length>0?"\u7DE8\u8F2F\u884C\u4E8B\u66C6":"\u65B0\u589E\u884C\u4E8B\u66C6"),1)]),_:1}),a(E,null,{default:n(()=>[a(X,null,{default:n(()=>[a(B,null,{default:n(()=>[a(C,{cols:"12"},{default:n(()=>[a(K,{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=l=>t.title=l),label:"\u6A19\u984C",rules:[L.required],variant:"outlined"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(W,null,{default:n(()=>[a(Y),a(m,{color:"error",onClick:e[1]||(e[1]=l=>t.dialog=!1),disabled:t.submitting},{default:n(()=>[ce]),_:1},8,["disabled"]),a(m,{type:"submit",color:"primary",loading:t.submitting},{default:n(()=>[me]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"]),a(T,{class:"display-flex justify-content-center",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l)},{default:n(()=>[a(A,null,{default:n(()=>[a(E,null,{default:n(()=>[u(f(S.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(q,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value=l),length:Math.ceil(i.length/c),rounded:"circle","next-icon":"mdi-menu-right","prev-icon":"mdi-menu-left"},null,8,["modelValue","length"])]))}};export{Se as default};
